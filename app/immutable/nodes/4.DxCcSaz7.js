import{s as _e,n as Z,d as ve,o as ye,f as Ie,r as ke}from"../chunks/scheduler.BoReh3vH.js";import{S as me,i as ge,e as G,s as T,t as U,c as R,a as N,y as L,f as A,b as O,d as b,o as B,g as P,h as d,j as Q,B as Y,A as z,n as J,l as W,m as we,k as $,u as be,v as xe,w as Ce,x as Se,q as Ge,p as ee}from"../chunks/index.BklZDJd0.js";import{e as j}from"../chunks/each.D6YF6ztN.js";import{s as M,r as X}from"../chunks/relics.9MHovSS4.js";import{i as te,a as le}from"../chunks/store.Cn0GNUQE.js";import{b as pe,g as Re}from"../chunks/entry.-L9Tc7hZ.js";const F=[{id:1,stageId:1,rocks:[{x:1,y:1},{x:0,y:3}],exits:[{x:0,y:0,destGridId:2,spawn:{x:4,y:4}},{x:4,y:2,destGridId:2,spawn:{x:0,y:2}},{x:2,y:4,destGridId:2,spawn:{x:2,y:0}}]},{id:2,stageId:1,rocks:[{x:3,y:1}],exits:[{x:1,y:0,destGridId:1,spawn:{x:3,y:4}},{x:4,y:3,destGridId:3,spawn:{x:0,y:1}}]},{id:3,stageId:2,rocks:[{x:1,y:3},{x:4,y:1}],exits:[{x:0,y:4,destGridId:2,spawn:{x:4,y:0}},{x:4,y:0,destGridId:4,spawn:{x:0,y:4}},{x:2,y:0,destGridId:4,spawn:{x:2,y:4}}]},{id:4,stageId:2,rocks:[{x:0,y:2},{x:2,y:3}],exits:[{x:1,y:4,destGridId:3,spawn:{x:3,y:0}},{x:3,y:0,destGridId:5,spawn:{x:1,y:4}}]},{id:5,stageId:3,rocks:[{x:3,y:4},{x:1,y:2}],exits:[{x:0,y:4,destGridId:4,spawn:{x:3,y:0}},{x:1,y:0,destGridId:6,spawn:{x:3,y:0}}]},{id:6,stageId:3,rocks:[{x:0,y:3},{x:4,y:3}],exits:[{x:0,y:0,destGridId:5,spawn:{x:3,y:0}}]}];function ie(r,e,l){const t=r.slice();return t[8]=e[l],t}function re(r){let e;return{c(){e=U("Active")},l(l){e=O(l,"Active")},m(l,t){P(l,e,t)},d(l){l&&b(e)}}}function se(r){let e,l="Buy",t,i;function s(){return r[6](r[8])}return{c(){e=G("button"),e.textContent=l},l(n){e=R(n,"BUTTON",{"data-svelte-h":!0}),L(e)!=="svelte-yl076z"&&(e.textContent=l)},m(n,p){P(n,e,p),t||(i=z(e,"click",s),t=!0)},p(n,p){r=n},d(n){n&&b(e),t=!1,i()}}}function ne(r){let e,l,t,i,s,n=r[8].name+"",p,C,S,E,c,g=r[8].description+"",v,y,f,h,I=r[8].price+"",w,x,u,k,_=r[8].id===r[1].id&&re(),a=r[8].id!==r[1].id&&se(r);return{c(){e=G("div"),l=G("img"),i=T(),s=G("h4"),p=U(n),C=T(),S=G("p"),_&&_.c(),E=T(),c=G("p"),v=U(g),y=T(),f=G("p"),h=U("Price: "),w=U(I),x=U(" drachmas"),u=T(),a&&a.c(),k=T(),this.h()},l(o){e=R(o,"DIV",{class:!0});var m=N(e);l=R(m,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),i=A(m),s=R(m,"H4",{});var D=N(s);p=O(D,n),D.forEach(b),C=A(m),S=R(m,"P",{class:!0});var V=N(S);_&&_.l(V),V.forEach(b),E=A(m),c=R(m,"P",{});var H=N(c);v=O(H,g),H.forEach(b),y=A(m),f=R(m,"P",{});var q=N(f);h=O(q,"Price: "),w=O(q,I),x=O(q," drachmas"),q.forEach(b),u=A(m),a&&a.l(m),k=A(m),m.forEach(b),this.h()},h(){ve(l.src,t=pe+"/game/"+r[8].img)||B(l,"src",t),B(l,"width","46px"),B(l,"height","46px"),B(l,"alt",r[8].name),B(l,"class","svelte-10kmyxf"),B(S,"class","active"),B(e,"class","menu-item svelte-10kmyxf")},m(o,m){P(o,e,m),d(e,l),d(e,i),d(e,s),d(s,p),d(e,C),d(e,S),_&&_.m(S,null),d(e,E),d(e,c),d(c,v),d(e,y),d(e,f),d(f,h),d(f,w),d(f,x),d(e,u),a&&a.m(e,null),d(e,k)},p(o,m){o[8].id===o[1].id?_||(_=re(),_.c(),_.m(S,null)):_&&(_.d(1),_=null),o[8].id!==o[1].id?a?a.p(o,m):(a=se(o),a.c(),a.m(e,k)):a&&(a.d(1),a=null)},d(o){o&&b(e),_&&_.d(),a&&a.d()}}}function Ee(r){let e,l,t="Relic Store",i,s,n,p=`${r[1].name}
    (${M.find(r[5]).name})`,C,S,E,c,g,v,y,f=j(r[2]),h=[];for(let I=0;I<f.length;I+=1)h[I]=ne(ie(r,f,I));return{c(){e=G("div"),l=G("h2"),l.textContent=t,i=T(),s=G("h4"),n=U("Chosen Relic: "),C=U(p),S=T(),E=G("h4"),c=U("Drachmas: "),g=U(r[0]),v=T(),y=G("div");for(let I=0;I<h.length;I+=1)h[I].c();this.h()},l(I){e=R(I,"DIV",{class:!0});var w=N(e);l=R(w,"H2",{"data-svelte-h":!0}),L(l)!=="svelte-6gh0hs"&&(l.textContent=t),i=A(w),s=R(w,"H4",{});var x=N(s);n=O(x,"Chosen Relic: "),C=O(x,p),x.forEach(b),S=A(w),E=R(w,"H4",{});var u=N(E);c=O(u,"Drachmas: "),g=O(u,r[0]),u.forEach(b),v=A(w),y=R(w,"DIV",{});var k=N(y);for(let _=0;_<h.length;_+=1)h[_].l(k);k.forEach(b),w.forEach(b),this.h()},h(){B(e,"class","menu svelte-10kmyxf")},m(I,w){P(I,e,w),d(e,l),d(e,i),d(e,s),d(s,n),d(s,C),d(e,S),d(e,E),d(E,c),d(E,g),d(e,v),d(e,y);for(let x=0;x<h.length;x+=1)h[x]&&h[x].m(y,null)},p(I,[w]){if(w&2&&p!==(p=`${I[1].name}
    (${M.find(I[5]).name})`)&&Q(C,p),w&1&&Q(g,I[0]),w&14){f=j(I[2]);let x;for(x=0;x<f.length;x+=1){const u=ie(I,f,x);h[x]?h[x].p(u,w):(h[x]=ne(u),h[x].c(),h[x].m(y,null))}for(;x<h.length;x+=1)h[x].d(1);h.length=f.length}},i:Z,o:Z,d(I){I&&b(e),Y(h,I)}}}function De(r,e,l){let{drachmas:t}=e,{chosenRelic:i}=e,{curGridId:s}=e;const n=M.find(c=>c.id===F.find(g=>g.id===s).stageId),p=X.filter(c=>c.stageId===n.id),C=c=>{try{if(t>=c.price){l(0,t-=c.price),localStorage.setItem("drachmas",t),l(1,i=c),localStorage.setItem("chosenRelicId",c.id),window.location.reload();return}alert("Not enough drachmas to spend!")}catch(g){console.error(g)}},S=c=>c.id===i.stageId,E=c=>C(c);return r.$$set=c=>{"drachmas"in c&&l(0,t=c.drachmas),"chosenRelic"in c&&l(1,i=c.chosenRelic),"curGridId"in c&&l(4,s=c.curGridId)},[t,i,p,C,s,S,E]}class Te extends me{constructor(e){super(),ge(this,e,De,Ee,_e,{drachmas:0,chosenRelic:1,curGridId:4})}}function ae(r,e,l){const t=r.slice();return t[17]=e[l],t[19]=l,t}function oe(r,e,l){const t=r.slice();return t[17]=e[l],t[21]=l,t}function ce(r){let e,l,t,i,s,n,p,C,S="←",E,c,g,v="↑",y,f,h="↓",I,w,x="→",u,k,_=j(Array(K)),a=[];for(let o=0;o<_.length;o+=1)a[o]=fe(ae(r,_,o));return{c(){e=G("h2"),l=U(r[2]),t=T(),i=G("div");for(let o=0;o<a.length;o+=1)a[o].c();n=T(),p=G("div"),C=G("button"),C.textContent=S,E=T(),c=G("div"),g=G("button"),g.textContent=v,y=T(),f=G("button"),f.textContent=h,I=T(),w=G("button"),w.textContent=x,this.h()},l(o){e=R(o,"H2",{});var m=N(e);l=O(m,r[2]),m.forEach(b),t=A(o),i=R(o,"DIV",{class:!0});var D=N(i);for(let q=0;q<a.length;q+=1)a[q].l(D);D.forEach(b),n=A(o),p=R(o,"DIV",{class:!0});var V=N(p);C=R(V,"BUTTON",{"data-svelte-h":!0}),L(C)!=="svelte-1h6m8u8"&&(C.textContent=S),E=A(V),c=R(V,"DIV",{});var H=N(c);g=R(H,"BUTTON",{"data-svelte-h":!0}),L(g)!=="svelte-1un4tkd"&&(g.textContent=v),y=A(H),f=R(H,"BUTTON",{"data-svelte-h":!0}),L(f)!=="svelte-16pn8vi"&&(f.textContent=h),H.forEach(b),I=A(V),w=R(V,"BUTTON",{"data-svelte-h":!0}),L(w)!=="svelte-87vidd"&&(w.textContent=x),V.forEach(b),this.h()},h(){B(i,"class",s="grid grid-bg-"+r[1]+" svelte-9rwrge"),B(p,"class","button-row")},m(o,m){P(o,e,m),d(e,l),P(o,t,m),P(o,i,m);for(let D=0;D<a.length;D+=1)a[D]&&a[D].m(i,null);P(o,n,m),P(o,p,m),d(p,C),d(p,E),d(p,c),d(c,g),d(c,y),d(c,f),d(p,I),d(p,w),u||(k=[z(C,"click",r[8]),z(g,"click",r[9]),z(f,"click",r[10]),z(w,"click",r[11])],u=!0)},p(o,m){if(m&4&&Q(l,o[2]),m&99){_=j(Array(K));let D;for(D=0;D<_.length;D+=1){const V=ae(o,_,D);a[D]?a[D].p(V,m):(a[D]=fe(V),a[D].c(),a[D].m(i,null))}for(;D<a.length;D+=1)a[D].d(1);a.length=_.length}m&2&&s!==(s="grid grid-bg-"+o[1]+" svelte-9rwrge")&&B(i,"class",s)},d(o){o&&(b(e),b(t),b(i),b(n),b(p)),Y(a,o),u=!1,ke(k)}}}function de(r){let e,l;return{c(){e=G("div"),this.h()},l(t){e=R(t,"DIV",{class:!0,style:!0}),N(e).forEach(b),this.h()},h(){B(e,"class",l="cell "+r[6](r[21],r[19],r[0],r[1])+" svelte-9rwrge"),ee(e,"background",r[6](r[21],r[19],r[0],r[1])==="player"?r[5].style:"")},m(t,i){P(t,e,i)},p(t,i){i&3&&l!==(l="cell "+t[6](t[21],t[19],t[0],t[1])+" svelte-9rwrge")&&B(e,"class",l),i&35&&ee(e,"background",t[6](t[21],t[19],t[0],t[1])==="player"?t[5].style:"")},d(t){t&&b(e)}}}function fe(r){let e,l=j(Array(K)),t=[];for(let i=0;i<l.length;i+=1)t[i]=de(oe(r,l,i));return{c(){for(let i=0;i<t.length;i+=1)t[i].c();e=$()},l(i){for(let s=0;s<t.length;s+=1)t[s].l(i);e=$()},m(i,s){for(let n=0;n<t.length;n+=1)t[n]&&t[n].m(i,s);P(i,e,s)},p(i,s){if(s&99){l=j(Array(K));let n;for(n=0;n<l.length;n+=1){const p=oe(i,l,n);t[n]?t[n].p(p,s):(t[n]=de(p),t[n].c(),t[n].m(e.parentNode,e))}for(;n<t.length;n+=1)t[n].d(1);t.length=l.length}},d(i){i&&b(e),Y(t,i)}}}function ue(r){let e,l="Battle",t,i;return{c(){e=G("button"),e.textContent=l},l(s){e=R(s,"BUTTON",{"data-svelte-h":!0}),L(e)!=="svelte-1th9psb"&&(e.textContent=l)},m(s,n){P(s,e,n),t||(i=z(e,"click",r[13]),t=!0)},d(s){s&&b(e),t=!1,i()}}}function he(r){let e,l;return e=new Te({props:{drachmas:r[4],chosenRelic:r[5],curGridId:r[1]}}),{c(){be(e.$$.fragment)},l(t){xe(e.$$.fragment,t)},m(t,i){Ce(e,t,i),l=!0},p(t,i){const s={};i&16&&(s.drachmas=t[4]),i&32&&(s.chosenRelic=t[5]),i&2&&(s.curGridId=t[1]),e.$set(s)},i(t){l||(J(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){Se(e,t)}}}function Ae(r){let e,l,t,i,s=r[3]?"Close Relic Store":"Relic Store",n,p,C,S,E,c,g=!r[3]&&ce(r),v=!r[3]&&ue(r),y=r[3]&&he(r);return{c(){e=G("div"),g&&g.c(),l=T(),t=G("div"),i=G("button"),n=U(s),p=T(),v&&v.c(),C=T(),y&&y.c(),this.h()},l(f){e=R(f,"DIV",{class:!0});var h=N(e);g&&g.l(h),l=A(h),t=R(h,"DIV",{class:!0});var I=N(t);i=R(I,"BUTTON",{});var w=N(i);n=O(w,s),w.forEach(b),p=A(I),v&&v.l(I),I.forEach(b),C=A(h),y&&y.l(h),h.forEach(b),this.h()},h(){B(t,"class","button-row"),B(e,"class","game-container svelte-9rwrge")},m(f,h){P(f,e,h),g&&g.m(e,null),d(e,l),d(e,t),d(t,i),d(i,n),d(t,p),v&&v.m(t,null),d(e,C),y&&y.m(e,null),S=!0,E||(c=z(i,"click",r[12]),E=!0)},p(f,[h]){f[3]?g&&(g.d(1),g=null):g?g.p(f,h):(g=ce(f),g.c(),g.m(e,l)),(!S||h&8)&&s!==(s=f[3]?"Close Relic Store":"Relic Store")&&Q(n,s),f[3]?v&&(v.d(1),v=null):v||(v=ue(f),v.c(),v.m(t,null)),f[3]?y?(y.p(f,h),h&8&&J(y,1)):(y=he(f),y.c(),J(y,1),y.m(e,null)):y&&(Ge(),W(y,1,1,()=>{y=null}),we())},i(f){S||(J(y),S=!0)},o(f){W(y),S=!1},d(f){f&&b(e),g&&g.d(),v&&v.d(),y&&y.d(),E=!1,c()}}}const K=5;function Ne(r,e,l){let t={x:2,y:2},i=1,s=M[0].name,n=!1,p=0,C=0,S=X[0];const E=u=>{u.key==="ArrowUp"&&(u.preventDefault(),v("up")),u.key==="ArrowDown"&&(u.preventDefault(),v("down")),u.key==="ArrowLeft"&&(u.preventDefault(),v("left")),u.key==="ArrowRight"&&(u.preventDefault(),v("right"))},c=(u,k,_,a)=>{try{if(_.x===u&&_.y===k)return"player";const o=F.find(m=>m.id===a);return o.rocks.find(m=>m.x===u&&m.y===k)?"rock":o.exits.find(m=>m.x===u&&m.y===k)?"exit":""}catch(o){console.error(o)}},g=()=>{const u=F.find(_=>_.id===i).exits.find(_=>_.x===t.x&&_.y===t.y),k=M.find(_=>_.id===F.find(a=>a.id===u.destGridId).stageId);if(p<k.expReq){alert("Not enough experience to use portal! (Requires "+k.expReq+" experience)");return}u&&(l(1,i=u.destGridId),localStorage.setItem("curStageId",k.id),localStorage.setItem("gridId",i),l(2,s=k.name),l(0,t=u.spawn))},v=u=>{try{let k={...t};if(u==="up"&&(k.y-=1),u==="down"&&(k.y+=1),u==="left"&&(k.x-=1),u==="right"&&(k.x+=1),k.x<0||k.x>=K||k.y<0||k.y>=K)return;const _=F.find(a=>a.id===i);_.rocks.find(a=>a.x===k.x&&a.y===k.y)||l(0,t=k),_.exits.find(a=>a.x===t.x&&a.y===t.y)&&g()}catch(k){console.error(k)}};return ye(()=>{te.set(!0),le.set(!0),localStorage.getItem("curStageId")&&l(2,s=M.find(u=>u.id===parseInt(localStorage.getItem("curStageId"))).name),localStorage.getItem("gridId")&&l(1,i=parseInt(localStorage.getItem("gridId"))),localStorage.getItem("playerExperience")&&(p=parseInt(localStorage.getItem("playerExperience"))),localStorage.getItem("drachmas")&&l(4,C=parseInt(localStorage.getItem("drachmas"))),localStorage.getItem("chosenRelicId")&&l(5,S=X.find(u=>u.id===parseInt(localStorage.getItem("chosenRelicId")))),typeof window<"u"&&window.addEventListener("keydown",E)}),Ie(()=>{te.set(!1),le.set(!1),typeof window<"u"&&window.removeEventListener("keydown",E)}),[t,i,s,n,C,S,c,v,()=>v("left"),()=>v("up"),()=>v("down"),()=>v("right"),()=>l(3,n=!n),()=>Re(pe+"/game")]}class He extends me{constructor(e){super(),ge(this,e,Ne,Ae,_e,{})}}export{He as component};
