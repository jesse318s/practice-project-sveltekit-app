import{s as fe,n as X,d as _e,o as ge,f as pe}from"../chunks/scheduler.BoReh3vH.js";import{S as de,i as he,e as b,s as A,t as D,c as k,a as R,y as ue,f as C,b as P,d as p,o as S,g as x,h as _,j as K,B as F,A as me,n as U,l as O,m as ve,k as Y,u as ye,v as Ie,w as be,x as ke,q as we}from"../chunks/index.BklZDJd0.js";import{e as N}from"../chunks/each.D6YF6ztN.js";import{i as Z,a as $}from"../chunks/store.Cn0GNUQE.js";import{r as j,s as M}from"../chunks/relics.CGlwEWe2.js";import{b as Se}from"../chunks/paths.DpnUdNk2.js";const L=[{id:1,rocks:[{x:1,y:1},{x:3,y:3},{x:0,y:4}],exits:[{x:0,y:0,destGridId:2,spawn:{x:4,y:4}},{x:4,y:2,destGridId:2,spawn:{x:0,y:2}},{x:2,y:4,destGridId:2,spawn:{x:2,y:0}}]},{id:2,rocks:[{x:1,y:3},{x:4,y:1}],exits:[{x:0,y:4,destGridId:1,spawn:{x:4,y:0}},{x:4,y:0,destGridId:1,spawn:{x:0,y:4}},{x:2,y:0,destGridId:1,spawn:{x:2,y:4}}]}];function ee(n,e,l){const t=n.slice();return t[6]=e[l],t}function te(n){let e;return{c(){e=D("Active")},l(l){e=P(l,"Active")},m(l,t){x(l,e,t)},d(l){l&&p(e)}}}function le(n){let e,l="Buy",t,s;function o(){return n[5](n[6])}return{c(){e=b("button"),e.textContent=l,this.h()},l(i){e=k(i,"BUTTON",{class:!0,"data-svelte-h":!0}),ue(e)!=="svelte-yl076z"&&(e.textContent=l),this.h()},h(){S(e,"class","svelte-7eusns")},m(i,c){x(i,e,c),t||(s=me(e,"click",o),t=!0)},p(i,c){n=i},d(i){i&&p(e),t=!1,s()}}}function se(n){let e,l,t,s,o,i=n[6].name+"",c,g,r,h,f,d=n[6].description+"",m,a,u,v,B=n[6].price+"",V,E,z,q,w=n[6].id===n[1].id&&te(),I=n[6].id!==n[1].id&&le(n);return{c(){e=b("div"),l=b("img"),s=A(),o=b("h3"),c=D(i),g=A(),r=b("p"),w&&w.c(),h=A(),f=b("p"),m=D(d),a=A(),u=b("p"),v=D("Price: "),V=D(B),E=D(" drachmas"),z=A(),I&&I.c(),q=A(),this.h()},l(G){e=k(G,"DIV",{class:!0});var y=R(e);l=k(y,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),s=C(y),o=k(y,"H3",{});var J=R(o);c=P(J,i),J.forEach(p),g=C(y),r=k(y,"P",{class:!0});var Q=R(r);w&&w.l(Q),Q.forEach(p),h=C(y),f=k(y,"P",{});var W=R(f);m=P(W,d),W.forEach(p),a=C(y),u=k(y,"P",{});var H=R(u);v=P(H,"Price: "),V=P(H,B),E=P(H," drachmas"),H.forEach(p),z=C(y),I&&I.l(y),q=C(y),y.forEach(p),this.h()},h(){_e(l.src,t=Se+"/"+n[6].img)||S(l,"src",t),S(l,"width","46px"),S(l,"height","46px"),S(l,"alt",n[6].name),S(l,"class","svelte-7eusns"),S(r,"class","active"),S(e,"class","menu-item svelte-7eusns")},m(G,y){x(G,e,y),_(e,l),_(e,s),_(e,o),_(o,c),_(e,g),_(e,r),w&&w.m(r,null),_(e,h),_(e,f),_(f,m),_(e,a),_(e,u),_(u,v),_(u,V),_(u,E),_(e,z),I&&I.m(e,null),_(e,q)},p(G,y){G[6].id===G[1].id?w||(w=te(),w.c(),w.m(r,null)):w&&(w.d(1),w=null),G[6].id!==G[1].id?I?I.p(G,y):(I=le(G),I.c(),I.m(e,q)):I&&(I.d(1),I=null)},d(G){G&&p(e),w&&w.d(),I&&I.d()}}}function Re(n){let e,l,t="Relic Store",s,o,i,c,g,r,h=N(n[2]),f=[];for(let d=0;d<h.length;d+=1)f[d]=se(ee(n,h,d));return{c(){e=b("div"),l=b("h2"),l.textContent=t,s=A(),o=b("p"),i=D("Drachmas: "),c=D(n[0]),g=A(),r=b("div");for(let d=0;d<f.length;d+=1)f[d].c();this.h()},l(d){e=k(d,"DIV",{class:!0});var m=R(e);l=k(m,"H2",{"data-svelte-h":!0}),ue(l)!=="svelte-6gh0hs"&&(l.textContent=t),s=C(m),o=k(m,"P",{});var a=R(o);i=P(a,"Drachmas: "),c=P(a,n[0]),a.forEach(p),g=C(m),r=k(m,"DIV",{});var u=R(r);for(let v=0;v<f.length;v+=1)f[v].l(u);u.forEach(p),m.forEach(p),this.h()},h(){S(e,"class","menu svelte-7eusns")},m(d,m){x(d,e,m),_(e,l),_(e,s),_(e,o),_(o,i),_(o,c),_(e,g),_(e,r);for(let a=0;a<f.length;a+=1)f[a]&&f[a].m(r,null)},p(d,[m]){if(m&1&&K(c,d[0]),m&14){h=N(d[2]);let a;for(a=0;a<h.length;a+=1){const u=ee(d,h,a);f[a]?f[a].p(u,m):(f[a]=se(u),f[a].c(),f[a].m(r,null))}for(;a<f.length;a+=1)f[a].d(1);f.length=h.length}},i:X,o:X,d(d){d&&p(e),F(f,d)}}}function Ge(n,e,l){let{drachmas:t}=e,{chosenRelic:s}=e,{curGridId:o}=e;const i=j.filter(r=>r.stageId===o),c=r=>{if(t>=r.price){l(0,t-=r.price),localStorage.setItem("drachmas",t),l(1,s=r),localStorage.setItem("chosenRelicId",r.id),window.location.reload();return}alert("Not enough drachmas!")},g=r=>c(r);return n.$$set=r=>{"drachmas"in r&&l(0,t=r.drachmas),"chosenRelic"in r&&l(1,s=r.chosenRelic),"curGridId"in r&&l(4,o=r.curGridId)},[t,s,i,c,o,g]}class Ee extends de{constructor(e){super(),he(this,e,Ge,Re,fe,{drachmas:0,chosenRelic:1,curGridId:4})}}function ie(n,e,l){const t=n.slice();return t[11]=e[l],t[13]=l,t}function re(n,e,l){const t=n.slice();return t[11]=e[l],t[15]=l,t}function ne(n){let e,l,t,s,o=N(Array(T)),i=[];for(let c=0;c<o.length;c+=1)i[c]=oe(ie(n,o,c));return{c(){e=b("h2"),l=D(n[2]),t=A(),s=b("div");for(let c=0;c<i.length;c+=1)i[c].c();this.h()},l(c){e=k(c,"H2",{});var g=R(e);l=P(g,n[2]),g.forEach(p),t=C(c),s=k(c,"DIV",{class:!0});var r=R(s);for(let h=0;h<i.length;h+=1)i[h].l(r);r.forEach(p),this.h()},h(){S(s,"class","grid svelte-10erb0b")},m(c,g){x(c,e,g),_(e,l),x(c,t,g),x(c,s,g);for(let r=0;r<i.length;r+=1)i[r]&&i[r].m(s,null)},p(c,g){if(g&4&&K(l,c[2]),g&67){o=N(Array(T));let r;for(r=0;r<o.length;r+=1){const h=ie(c,o,r);i[r]?i[r].p(h,g):(i[r]=oe(h),i[r].c(),i[r].m(s,null))}for(;r<i.length;r+=1)i[r].d(1);i.length=o.length}},d(c){c&&(p(e),p(t),p(s)),F(i,c)}}}function ae(n){let e,l;return{c(){e=b("div"),this.h()},l(t){e=k(t,"DIV",{class:!0}),R(e).forEach(p),this.h()},h(){S(e,"class",l="cell "+n[6](n[15],n[13],n[0],n[1])+" svelte-10erb0b")},m(t,s){x(t,e,s)},p(t,s){s&3&&l!==(l="cell "+t[6](t[15],t[13],t[0],t[1])+" svelte-10erb0b")&&S(e,"class",l)},d(t){t&&p(e)}}}function oe(n){let e,l=N(Array(T)),t=[];for(let s=0;s<l.length;s+=1)t[s]=ae(re(n,l,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();e=Y()},l(s){for(let o=0;o<t.length;o+=1)t[o].l(s);e=Y()},m(s,o){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(s,o);x(s,e,o)},p(s,o){if(o&67){l=N(Array(T));let i;for(i=0;i<l.length;i+=1){const c=re(s,l,i);t[i]?t[i].p(c,o):(t[i]=ae(c),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=l.length}},d(s){s&&p(e),F(t,s)}}}function ce(n){let e,l;return e=new Ee({props:{drachmas:n[4],chosenRelic:n[5],curGridId:n[1]}}),{c(){ye(e.$$.fragment)},l(t){Ie(e.$$.fragment,t)},m(t,s){be(e,t,s),l=!0},p(t,s){const o={};s&16&&(o.drachmas=t[4]),s&32&&(o.chosenRelic=t[5]),s&2&&(o.curGridId=t[1]),e.$set(o)},i(t){l||(U(e.$$.fragment,t),l=!0)},o(t){O(e.$$.fragment,t),l=!1},d(t){ke(e,t)}}}function Ae(n){let e,l,t,s=n[3]?"Close Relic Store":"Relic Store",o,i,c,g,r,h=!n[3]&&ne(n),f=n[3]&&ce(n);return{c(){e=b("div"),h&&h.c(),l=A(),t=b("button"),o=D(s),i=A(),f&&f.c(),this.h()},l(d){e=k(d,"DIV",{class:!0});var m=R(e);h&&h.l(m),l=C(m),t=k(m,"BUTTON",{class:!0});var a=R(t);o=P(a,s),a.forEach(p),i=C(m),f&&f.l(m),m.forEach(p),this.h()},h(){S(t,"class","svelte-10erb0b"),S(e,"class","world svelte-10erb0b")},m(d,m){x(d,e,m),h&&h.m(e,null),_(e,l),_(e,t),_(t,o),_(e,i),f&&f.m(e,null),c=!0,g||(r=me(t,"click",n[7]),g=!0)},p(d,[m]){d[3]?h&&(h.d(1),h=null):h?h.p(d,m):(h=ne(d),h.c(),h.m(e,l)),(!c||m&8)&&s!==(s=d[3]?"Close Relic Store":"Relic Store")&&K(o,s),d[3]?f?(f.p(d,m),m&8&&U(f,1)):(f=ce(d),f.c(),U(f,1),f.m(e,null)):f&&(we(),O(f,1,1,()=>{f=null}),ve())},i(d){c||(U(f),c=!0)},o(d){O(f),c=!1},d(d){d&&p(e),h&&h.d(),f&&f.d(),g=!1,r()}}}const T=5;function Ce(n,e,l){let t={x:2,y:2},s=1,o=M.find(a=>a.id===s).name,i=!1,c=0,g=j[0];const r=(a,u,v,B)=>{if(v.x===a&&v.y===u)return"player";const V=L.find(E=>E.id===B);return V.rocks.find(E=>E.x===a&&E.y===u)?"rock":V.exits.find(E=>E.x===a&&E.y===u)?"exit":""},h=a=>{a.key==="ArrowUp"&&d("up"),a.key==="ArrowDown"&&d("down"),a.key==="ArrowLeft"&&d("left"),a.key==="ArrowRight"&&d("right")},f=()=>{const a=L.find(u=>u.id===s).exits.find(u=>u.x===t.x&&u.y===t.y);a&&(l(1,s=a.destGridId),localStorage.setItem("curStageId",s),l(2,o=M.find(u=>u.id===s).name),l(0,t=a.spawn))},d=a=>{let u={...t};a==="up"&&(u.y-=1),a==="down"&&(u.y+=1),a==="left"&&(u.x-=1),a==="right"&&(u.x+=1),!(u.x<0||u.x>=T||u.y<0||u.y>=T)&&(L.find(v=>v.id===s).rocks.find(v=>v.x===u.x&&v.y===u.y)||l(0,t=u),L.find(v=>v.id===s).exits.find(v=>v.x===t.x&&v.y===t.y)&&f())};return ge(()=>{Z.set(!0),$.set(!0),localStorage.getItem("curStageId")&&(l(1,s=parseInt(localStorage.getItem("curStageId"))),l(2,o=M.find(a=>a.id===s).name)),localStorage.getItem("drachmas")&&l(4,c=parseInt(localStorage.getItem("drachmas"))),localStorage.getItem("chosenRelicId")&&l(5,g=j.find(a=>a.id===parseInt(localStorage.getItem("chosenRelicId")))),typeof window<"u"&&window.addEventListener("keydown",h)}),pe(()=>{Z.set(!1),$.set(!1),typeof window<"u"&&window.removeEventListener("keydown",h)}),[t,s,o,i,c,g,r,()=>l(3,i=!i)]}class Be extends de{constructor(e){super(),he(this,e,Ce,Ae,fe,{})}}export{Be as component};
