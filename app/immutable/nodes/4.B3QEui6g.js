import{s as te,n as Q,d as Se,o as Re,f as Te,r as we}from"../chunks/scheduler.BoReh3vH.js";import{S as le,i as se,e as I,s as R,t as U,c as k,a as N,y as H,f as T,b as V,d as p,o as b,g as D,h as m,j as $,B as Z,A as z,p as Y,z as De,n as j,l as F,m as ie,k as ne,u as xe,v as Ce,w as Ge,x as qe,q as re}from"../chunks/index.BklZDJd0.js";import{e as W}from"../chunks/each.D6YF6ztN.js";import{s as L,r as ee}from"../chunks/relics.Bej4_qsT.js";import{i as ae,a as oe}from"../chunks/store.Cn0GNUQE.js";import{b as Ee,g as Ae}from"../chunks/entry.GRTdbKiB.js";const J=[{id:1,stageId:1,rocks:[{x:1,y:1,type:"plain"},{x:0,y:3,type:"plain"}],exits:[{x:0,y:0,destGridId:2,spawn:{x:4,y:4}},{x:4,y:2,destGridId:2,spawn:{x:0,y:2}},{x:2,y:4,destGridId:2,spawn:{x:2,y:0}}]},{id:2,stageId:1,rocks:[{x:3,y:1,type:"smooth"}],exits:[{x:1,y:0,destGridId:1,spawn:{x:3,y:4}},{x:4,y:3,destGridId:3,spawn:{x:0,y:1}}]},{id:3,stageId:2,rocks:[{x:1,y:3,type:"smooth"},{x:4,y:1,type:"smooth"}],exits:[{x:0,y:4,destGridId:2,spawn:{x:4,y:0}},{x:4,y:0,destGridId:4,spawn:{x:0,y:4}},{x:2,y:0,destGridId:4,spawn:{x:2,y:4}}]},{id:4,stageId:2,rocks:[{x:0,y:2,type:"smooth"},{x:2,y:3,type:"plain"}],exits:[{x:1,y:4,destGridId:3,spawn:{x:3,y:0}},{x:3,y:0,destGridId:5,spawn:{x:1,y:4}}]},{id:5,stageId:3,rocks:[{x:3,y:4,type:"plain"},{x:1,y:2,type:"plain"}],exits:[{x:0,y:4,destGridId:4,spawn:{x:3,y:0}},{x:1,y:0,destGridId:6,spawn:{x:3,y:0}}]},{id:6,stageId:3,rocks:[{x:0,y:3,type:"smooth"},{x:4,y:3,type:"smooth"}],exits:[{x:0,y:0,destGridId:5,spawn:{x:3,y:0}}]}];function ce(n,e,s){const t=n.slice();return t[8]=e[s],t}function de(n){let e;return{c(){e=U("Active")},l(s){e=V(s,"Active")},m(s,t){D(s,e,t)},d(s){s&&p(e)}}}function fe(n){let e,s="Buy",t,l;function c(){return n[6](n[8])}return{c(){e=I("button"),e.textContent=s,this.h()},l(i){e=k(i,"BUTTON",{class:!0,"data-svelte-h":!0}),H(e)!=="svelte-yl076z"&&(e.textContent=s),this.h()},h(){b(e,"class","svelte-bvbif0")},m(i,o){D(i,e,o),t||(l=z(e,"click",c),t=!0)},p(i,o){n=i},d(i){i&&p(e),t=!1,l()}}}function ue(n){let e,s,t,l,c,i=n[8].name+"",o,r,f,u,a,h=n[8].description+"",A,y,q,w,x=n[8].price+"",C,G,B,M,E=n[8].id===n[1].id&&de(),g=n[8].id!==n[1].id&&fe(n);return{c(){e=I("div"),s=I("img"),l=R(),c=I("h4"),o=U(i),r=R(),f=I("p"),E&&E.c(),u=R(),a=I("p"),A=U(h),y=R(),q=I("p"),w=U("Price: "),C=U(x),G=U(" drachmas"),B=R(),g&&g.c(),M=R(),this.h()},l(d){e=k(d,"DIV",{class:!0});var _=N(e);s=k(_,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),l=T(_),c=k(_,"H4",{});var v=N(c);o=V(v,i),v.forEach(p),r=T(_),f=k(_,"P",{class:!0});var S=N(f);E&&E.l(S),S.forEach(p),u=T(_),a=k(_,"P",{});var O=N(a);A=V(O,h),O.forEach(p),y=T(_),q=k(_,"P",{});var P=N(q);w=V(P,"Price: "),C=V(P,x),G=V(P," drachmas"),P.forEach(p),B=T(_),g&&g.l(_),M=T(_),_.forEach(p),this.h()},h(){Se(s.src,t=Ee+"/game/"+n[8].img)||b(s,"src",t),b(s,"width","46px"),b(s,"height","46px"),b(s,"alt",n[8].name),b(s,"class","svelte-bvbif0"),b(f,"class","active"),b(e,"class","menu-item svelte-bvbif0")},m(d,_){D(d,e,_),m(e,s),m(e,l),m(e,c),m(c,o),m(e,r),m(e,f),E&&E.m(f,null),m(e,u),m(e,a),m(a,A),m(e,y),m(e,q),m(q,w),m(q,C),m(q,G),m(e,B),g&&g.m(e,null),m(e,M)},p(d,_){d[8].id===d[1].id?E||(E=de(),E.c(),E.m(f,null)):E&&(E.d(1),E=null),d[8].id!==d[1].id?g?g.p(d,_):(g=fe(d),g.c(),g.m(e,M)):g&&(g.d(1),g=null)},d(d){d&&p(e),E&&E.d(),g&&g.d()}}}function Ne(n){let e,s,t="Relic Store",l,c,i,o=`${n[1].name}
    (${L.find(n[5]).name})`,r,f,u,a,h,A,y,q=W(n[2]),w=[];for(let x=0;x<q.length;x+=1)w[x]=ue(ce(n,q,x));return{c(){e=I("div"),s=I("h2"),s.textContent=t,l=R(),c=I("h4"),i=U("Chosen Relic: "),r=U(o),f=R(),u=I("h4"),a=U("Drachmas: "),h=U(n[0]),A=R(),y=I("div");for(let x=0;x<w.length;x+=1)w[x].c();this.h()},l(x){e=k(x,"DIV",{class:!0});var C=N(e);s=k(C,"H2",{"data-svelte-h":!0}),H(s)!=="svelte-6gh0hs"&&(s.textContent=t),l=T(C),c=k(C,"H4",{});var G=N(c);i=V(G,"Chosen Relic: "),r=V(G,o),G.forEach(p),f=T(C),u=k(C,"H4",{});var B=N(u);a=V(B,"Drachmas: "),h=V(B,n[0]),B.forEach(p),A=T(C),y=k(C,"DIV",{});var M=N(y);for(let E=0;E<w.length;E+=1)w[E].l(M);M.forEach(p),C.forEach(p),this.h()},h(){b(e,"class","menu svelte-bvbif0")},m(x,C){D(x,e,C),m(e,s),m(e,l),m(e,c),m(c,i),m(c,r),m(e,f),m(e,u),m(u,a),m(u,h),m(e,A),m(e,y);for(let G=0;G<w.length;G+=1)w[G]&&w[G].m(y,null)},p(x,[C]){if(C&2&&o!==(o=`${x[1].name}
    (${L.find(x[5]).name})`)&&$(r,o),C&1&&$(h,x[0]),C&14){q=W(x[2]);let G;for(G=0;G<q.length;G+=1){const B=ce(x,q,G);w[G]?w[G].p(B,C):(w[G]=ue(B),w[G].c(),w[G].m(y,null))}for(;G<w.length;G+=1)w[G].d(1);w.length=q.length}},i:Q,o:Q,d(x){x&&p(e),Z(w,x)}}}function Be(n,e,s){let{drachmas:t}=e,{chosenRelic:l}=e,{curGridId:c}=e;const i=L.find(a=>a.id===J.find(h=>h.id===c).stageId),o=ee.filter(a=>a.stageId===i.id),r=a=>{try{if(t>=a.price){s(0,t-=a.price),localStorage.setItem("drachmas",t),s(1,l=a),localStorage.setItem("chosenRelicId",a.id),window.location.reload();return}alert("Not enough drachmas to spend!")}catch(h){console.error(h)}},f=a=>a.id===l.stageId,u=a=>r(a);return n.$$set=a=>{"drachmas"in a&&s(0,t=a.drachmas),"chosenRelic"in a&&s(1,l=a.chosenRelic),"curGridId"in a&&s(4,c=a.curGridId)},[t,l,o,r,c,f,u]}class Pe extends le{constructor(e){super(),se(this,e,Be,Ne,te,{drachmas:0,chosenRelic:1,curGridId:4})}}function he(n,e,s){const t=n.slice();return t[3]=e[s],t}function Ue(n){let e,s="Current Stage";return{c(){e=I("p"),e.textContent=s,this.h()},l(t){e=k(t,"P",{class:!0,"data-svelte-h":!0}),H(e)!=="svelte-1nnd0gv"&&(e.textContent=s),this.h()},h(){b(e,"class","svelte-qbi2hn")},m(t,l){D(t,e,l)},d(t){t&&p(e)}}}function _e(n){let e,s,t=n[3].name+"",l,c,i,o,r=n[3].expReq+"",f,u,a,h=n[3].id===n[0].id&&Ue();return{c(){e=I("div"),s=I("h4"),l=U(t),c=R(),i=I("p"),o=U("Exp. Requirement: "),f=U(r),u=R(),h&&h.c(),a=R(),this.h()},l(A){e=k(A,"DIV",{class:!0,style:!0});var y=N(e);s=k(y,"H4",{class:!0});var q=N(s);l=V(q,t),q.forEach(p),c=T(y),i=k(y,"P",{class:!0});var w=N(i);o=V(w,"Exp. Requirement: "),f=V(w,r),w.forEach(p),u=T(y),h&&h.l(y),a=T(y),y.forEach(p),this.h()},h(){b(s,"class","svelte-qbi2hn"),b(i,"class","svelte-qbi2hn"),b(e,"class","stage svelte-qbi2hn"),Y(e,"grid-column",n[3].col),Y(e,"grid-row",n[3].row),De(e,"current",n[3].id===n[0].id)},m(A,y){D(A,e,y),m(e,s),m(s,l),m(e,c),m(e,i),m(i,o),m(i,f),m(e,u),h&&h.m(e,null),m(e,a)},p:Q,d(A){A&&p(e),h&&h.d()}}}function Ve(n){let e,s=W(L),t=[];for(let l=0;l<s.length;l+=1)t[l]=_e(he(n,s,l));return{c(){e=I("div");for(let l=0;l<t.length;l+=1)t[l].c();this.h()},l(l){e=k(l,"DIV",{class:!0,style:!0});var c=N(e);for(let i=0;i<t.length;i+=1)t[i].l(c);c.forEach(p),this.h()},h(){b(e,"class","world-map svelte-qbi2hn"),Y(e,"grid-template-rows","repeat("+n[1]+", 1fr)")},m(l,c){D(l,e,c);for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(e,null)},p(l,[c]){if(c&1){s=W(L);let i;for(i=0;i<s.length;i+=1){const o=he(l,s,i);t[i]?t[i].p(o,c):(t[i]=_e(o),t[i].c(),t[i].m(e,null))}for(;i<t.length;i+=1)t[i].d(1);t.length=s.length}},i:Q,o:Q,d(l){l&&p(e),Z(t,l)}}}function Oe(n,e,s){let{curGridId:t}=e;const l=L.find(i=>i.id===J.find(o=>o.id===t).stageId);let c=Math.max(...L.map(i=>i.row));return n.$$set=i=>{"curGridId"in i&&s(2,t=i.curGridId)},[l,c,t]}class He extends le{constructor(e){super(),se(this,e,Oe,Ve,te,{curGridId:2})}}function me(n,e,s){const t=n.slice();return t[21]=e[s],t[23]=s,t}function pe(n,e,s){const t=n.slice();return t[21]=e[s],t[25]=s,t}function ve(n){let e,s,t,l,c,i,o,r,f="←",u,a,h,A="↑",y,q,w="↓",x,C,G="→",B,M,E=W(Array(X)),g=[];for(let d=0;d<E.length;d+=1)g[d]=ye(me(n,E,d));return{c(){e=I("h2"),s=U(n[2]),t=R(),l=I("div");for(let d=0;d<g.length;d+=1)g[d].c();i=R(),o=I("div"),r=I("button"),r.textContent=f,u=R(),a=I("div"),h=I("button"),h.textContent=A,y=R(),q=I("button"),q.textContent=w,x=R(),C=I("button"),C.textContent=G,this.h()},l(d){e=k(d,"H2",{});var _=N(e);s=V(_,n[2]),_.forEach(p),t=T(d),l=k(d,"DIV",{class:!0});var v=N(l);for(let P=0;P<g.length;P+=1)g[P].l(v);v.forEach(p),i=T(d),o=k(d,"DIV",{class:!0});var S=N(o);r=k(S,"BUTTON",{class:!0,"data-svelte-h":!0}),H(r)!=="svelte-1h6m8u8"&&(r.textContent=f),u=T(S),a=k(S,"DIV",{});var O=N(a);h=k(O,"BUTTON",{class:!0,"data-svelte-h":!0}),H(h)!=="svelte-1un4tkd"&&(h.textContent=A),y=T(O),q=k(O,"BUTTON",{class:!0,"data-svelte-h":!0}),H(q)!=="svelte-16pn8vi"&&(q.textContent=w),O.forEach(p),x=T(S),C=k(S,"BUTTON",{class:!0,"data-svelte-h":!0}),H(C)!=="svelte-87vidd"&&(C.textContent=G),S.forEach(p),this.h()},h(){b(l,"class",c="grid grid-bg-"+n[1]+" svelte-sxq188"),b(r,"class","svelte-sxq188"),b(h,"class","svelte-sxq188"),b(q,"class","svelte-sxq188"),b(C,"class","svelte-sxq188"),b(o,"class","button-row")},m(d,_){D(d,e,_),m(e,s),D(d,t,_),D(d,l,_);for(let v=0;v<g.length;v+=1)g[v]&&g[v].m(l,null);D(d,i,_),D(d,o,_),m(o,r),m(o,u),m(o,a),m(a,h),m(a,y),m(a,q),m(o,x),m(o,C),B||(M=[z(r,"click",n[9]),z(h,"click",n[10]),z(q,"click",n[11]),z(C,"click",n[12])],B=!0)},p(d,_){if(_&4&&$(s,d[2]),_&195){E=W(Array(X));let v;for(v=0;v<E.length;v+=1){const S=me(d,E,v);g[v]?g[v].p(S,_):(g[v]=ye(S),g[v].c(),g[v].m(l,null))}for(;v<g.length;v+=1)g[v].d(1);g.length=E.length}_&2&&c!==(c="grid grid-bg-"+d[1]+" svelte-sxq188")&&b(l,"class",c)},d(d){d&&(p(e),p(t),p(l),p(i),p(o)),Z(g,d),B=!1,we(M)}}}function ge(n){let e,s;return{c(){e=I("div"),this.h()},l(t){e=k(t,"DIV",{class:!0,style:!0}),N(e).forEach(p),this.h()},h(){b(e,"class",s="cell "+n[7](n[25],n[23],n[0],n[1])+" svelte-sxq188"),Y(e,"background",n[7](n[25],n[23],n[0],n[1])==="player"?n[6].style:"")},m(t,l){D(t,e,l)},p(t,l){l&3&&s!==(s="cell "+t[7](t[25],t[23],t[0],t[1])+" svelte-sxq188")&&b(e,"class",s),l&67&&Y(e,"background",t[7](t[25],t[23],t[0],t[1])==="player"?t[6].style:"")},d(t){t&&p(e)}}}function ye(n){let e,s=W(Array(X)),t=[];for(let l=0;l<s.length;l+=1)t[l]=ge(pe(n,s,l));return{c(){for(let l=0;l<t.length;l+=1)t[l].c();e=ne()},l(l){for(let c=0;c<t.length;c+=1)t[c].l(l);e=ne()},m(l,c){for(let i=0;i<t.length;i+=1)t[i]&&t[i].m(l,c);D(l,e,c)},p(l,c){if(c&195){s=W(Array(X));let i;for(i=0;i<s.length;i+=1){const o=pe(l,s,i);t[i]?t[i].p(o,c):(t[i]=ge(o),t[i].c(),t[i].m(e.parentNode,e))}for(;i<t.length;i+=1)t[i].d(1);t.length=s.length}},d(l){l&&p(e),Z(t,l)}}}function Ie(n){let e,s="Relic Store",t,l,c="World Map",i,o,r="Battle",f,u;return{c(){e=I("button"),e.textContent=s,t=R(),l=I("button"),l.textContent=c,i=R(),o=I("button"),o.textContent=r,this.h()},l(a){e=k(a,"BUTTON",{class:!0,"data-svelte-h":!0}),H(e)!=="svelte-15z0tww"&&(e.textContent=s),t=T(a),l=k(a,"BUTTON",{class:!0,"data-svelte-h":!0}),H(l)!=="svelte-c1pyeu"&&(l.textContent=c),i=T(a),o=k(a,"BUTTON",{class:!0,"data-svelte-h":!0}),H(o)!=="svelte-1th9psb"&&(o.textContent=r),this.h()},h(){b(e,"class","svelte-sxq188"),b(l,"class","svelte-sxq188"),b(o,"class","svelte-sxq188")},m(a,h){D(a,e,h),D(a,t,h),D(a,l,h),D(a,i,h),D(a,o,h),f||(u=[z(e,"click",n[13]),z(l,"click",n[14]),z(o,"click",n[15])],f=!0)},p:Q,d(a){a&&(p(e),p(t),p(l),p(i),p(o)),f=!1,we(u)}}}function ke(n){let e,s="Travel",t,l,c,i,o;return l=new Pe({props:{drachmas:n[5],chosenRelic:n[6],curGridId:n[1]}}),{c(){e=I("button"),e.textContent=s,t=R(),xe(l.$$.fragment),this.h()},l(r){e=k(r,"BUTTON",{class:!0,"data-svelte-h":!0}),H(e)!=="svelte-wcjflf"&&(e.textContent=s),t=T(r),Ce(l.$$.fragment,r),this.h()},h(){b(e,"class","svelte-sxq188")},m(r,f){D(r,e,f),D(r,t,f),Ge(l,r,f),c=!0,i||(o=z(e,"click",n[16]),i=!0)},p(r,f){const u={};f&32&&(u.drachmas=r[5]),f&64&&(u.chosenRelic=r[6]),f&2&&(u.curGridId=r[1]),l.$set(u)},i(r){c||(j(l.$$.fragment,r),c=!0)},o(r){F(l.$$.fragment,r),c=!1},d(r){r&&(p(e),p(t)),qe(l,r),i=!1,o()}}}function be(n){let e,s="Travel",t,l,c,i,o;return l=new He({props:{curGridId:n[1]}}),{c(){e=I("button"),e.textContent=s,t=R(),xe(l.$$.fragment),this.h()},l(r){e=k(r,"BUTTON",{class:!0,"data-svelte-h":!0}),H(e)!=="svelte-15ex2c5"&&(e.textContent=s),t=T(r),Ce(l.$$.fragment,r),this.h()},h(){b(e,"class","svelte-sxq188")},m(r,f){D(r,e,f),D(r,t,f),Ge(l,r,f),c=!0,i||(o=z(e,"click",n[17]),i=!0)},p(r,f){const u={};f&2&&(u.curGridId=r[1]),l.$set(u)},i(r){c||(j(l.$$.fragment,r),c=!0)},o(r){F(l.$$.fragment,r),c=!1},d(r){r&&(p(e),p(t)),qe(l,r),i=!1,o()}}}function Me(n){let e,s,t,l,c,i,o=!n[3]&&!n[4]&&ve(n),r=!n[3]&&!n[4]&&Ie(n),f=n[3]&&ke(n),u=n[4]&&be(n);return{c(){e=I("div"),o&&o.c(),s=R(),t=I("div"),r&&r.c(),l=R(),f&&f.c(),c=R(),u&&u.c(),this.h()},l(a){e=k(a,"DIV",{class:!0});var h=N(e);o&&o.l(h),s=T(h),t=k(h,"DIV",{class:!0});var A=N(t);r&&r.l(A),A.forEach(p),l=T(h),f&&f.l(h),c=T(h),u&&u.l(h),h.forEach(p),this.h()},h(){b(t,"class","button-row"),b(e,"class","game-container svelte-sxq188")},m(a,h){D(a,e,h),o&&o.m(e,null),m(e,s),m(e,t),r&&r.m(t,null),m(e,l),f&&f.m(e,null),m(e,c),u&&u.m(e,null),i=!0},p(a,[h]){!a[3]&&!a[4]?o?o.p(a,h):(o=ve(a),o.c(),o.m(e,s)):o&&(o.d(1),o=null),!a[3]&&!a[4]?r?r.p(a,h):(r=Ie(a),r.c(),r.m(t,null)):r&&(r.d(1),r=null),a[3]?f?(f.p(a,h),h&8&&j(f,1)):(f=ke(a),f.c(),j(f,1),f.m(e,c)):f&&(re(),F(f,1,1,()=>{f=null}),ie()),a[4]?u?(u.p(a,h),h&16&&j(u,1)):(u=be(a),u.c(),j(u,1),u.m(e,null)):u&&(re(),F(u,1,1,()=>{u=null}),ie())},i(a){i||(j(f),j(u),i=!0)},o(a){F(f),F(u),i=!1},d(a){a&&p(e),o&&o.d(),r&&r.d(),f&&f.d(),u&&u.d()}}}const X=5;function ze(n,e,s){let t={x:2,y:2},l=1,c=L[0].name,i=!1,o=!1,r=0,f=0,u=ee[0];const a=d=>{d.key==="ArrowUp"&&(d.preventDefault(),y("up")),d.key==="ArrowDown"&&(d.preventDefault(),y("down")),d.key==="ArrowLeft"&&(d.preventDefault(),y("left")),d.key==="ArrowRight"&&(d.preventDefault(),y("right"))},h=(d,_,v,S)=>{try{if(v.x===d&&v.y===_)return"player";const O=J.find(K=>K.id===S),P=O.rocks.find(K=>K.x===d&&K.y===_);return(P==null?void 0:P.type)==="plain"?"rock-plain":(P==null?void 0:P.type)==="smooth"?"rock-smooth":O.exits.find(K=>K.x===d&&K.y===_)?"exit":""}catch(O){console.error(O)}},A=()=>{const d=J.find(v=>v.id===l).exits.find(v=>v.x===t.x&&v.y===t.y),_=L.find(v=>v.id===J.find(S=>S.id===d.destGridId).stageId);if(r<_.expReq){alert("Not enough experience to use portal! (Requires "+_.expReq+" experience)");return}d&&(s(1,l=d.destGridId),localStorage.setItem("curStageId",_.id),localStorage.setItem("gridId",l),s(2,c=_.name),s(0,t=d.spawn))},y=d=>{try{let _={...t};if(d==="up"&&(_.y-=1),d==="down"&&(_.y+=1),d==="left"&&(_.x-=1),d==="right"&&(_.x+=1),_.x<0||_.x>=X||_.y<0||_.y>=X)return;const v=J.find(S=>S.id===l);v.rocks.find(S=>S.x===_.x&&S.y===_.y)||s(0,t=_),v.exits.find(S=>S.x===t.x&&S.y===t.y)&&A()}catch(_){console.error(_)}};return Re(()=>{ae.set(!0),oe.set(!0),localStorage.getItem("curStageId")&&s(2,c=L.find(d=>d.id===parseInt(localStorage.getItem("curStageId"))).name),localStorage.getItem("gridId")&&s(1,l=parseInt(localStorage.getItem("gridId"))),localStorage.getItem("playerExperience")&&(r=parseInt(localStorage.getItem("playerExperience"))),localStorage.getItem("drachmas")&&s(5,f=parseInt(localStorage.getItem("drachmas"))),localStorage.getItem("chosenRelicId")&&s(6,u=ee.find(d=>d.id===parseInt(localStorage.getItem("chosenRelicId")))),typeof window<"u"&&window.addEventListener("keydown",a)}),Te(()=>{ae.set(!1),oe.set(!1),typeof window<"u"&&window.removeEventListener("keydown",a)}),[t,l,c,i,o,f,u,h,y,()=>y("left"),()=>y("up"),()=>y("down"),()=>y("right"),()=>s(3,i=!0),()=>s(4,o=!0),()=>Ae(Ee+"/game"),()=>s(3,i=!1),()=>s(4,o=!1)]}class Qe extends le{constructor(e){super(),se(this,e,ze,Me,te,{})}}export{Qe as component};
