import{s as _e,n as Z,d as ve,o as ye,f as Ie,r as ke}from"../chunks/scheduler.BoReh3vH.js";import{S as me,i as pe,e as R,s as T,t as V,c as E,a as N,y as L,f as A,b as U,d as w,o as D,g as B,h as f,j as Q,B as Y,A as z,n as J,l as W,m as be,k as $,u as xe,v as we,w as Ce,x as Se,q as Ge,p as ee}from"../chunks/index.BklZDJd0.js";import{e as j}from"../chunks/each.D6YF6ztN.js";import{s as M,r as X}from"../chunks/relics.9MHovSS4.js";import{i as te,a as le}from"../chunks/store.Cn0GNUQE.js";import{b as ge,g as Re}from"../chunks/entry.81xWpP38.js";const F=[{id:1,stageId:1,rocks:[{x:1,y:1,type:"plain"},{x:0,y:3,type:"plain"}],exits:[{x:0,y:0,destGridId:2,spawn:{x:4,y:4}},{x:4,y:2,destGridId:2,spawn:{x:0,y:2}},{x:2,y:4,destGridId:2,spawn:{x:2,y:0}}]},{id:2,stageId:1,rocks:[{x:3,y:1,type:"smooth"}],exits:[{x:1,y:0,destGridId:1,spawn:{x:3,y:4}},{x:4,y:3,destGridId:3,spawn:{x:0,y:1}}]},{id:3,stageId:2,rocks:[{x:1,y:3,type:"smooth"},{x:4,y:1,type:"smooth"}],exits:[{x:0,y:4,destGridId:2,spawn:{x:4,y:0}},{x:4,y:0,destGridId:4,spawn:{x:0,y:4}},{x:2,y:0,destGridId:4,spawn:{x:2,y:4}}]},{id:4,stageId:2,rocks:[{x:0,y:2,type:"smooth"},{x:2,y:3,type:"plain"}],exits:[{x:1,y:4,destGridId:3,spawn:{x:3,y:0}},{x:3,y:0,destGridId:5,spawn:{x:1,y:4}}]},{id:5,stageId:3,rocks:[{x:3,y:4,type:"plain"},{x:1,y:2,type:"plain"}],exits:[{x:0,y:4,destGridId:4,spawn:{x:3,y:0}},{x:1,y:0,destGridId:6,spawn:{x:3,y:0}}]},{id:6,stageId:3,rocks:[{x:0,y:3,type:"smooth"},{x:4,y:3,type:"smooth"}],exits:[{x:0,y:0,destGridId:5,spawn:{x:3,y:0}}]}];function se(i,e,l){const t=i.slice();return t[8]=e[l],t}function ie(i){let e;return{c(){e=V("Active")},l(l){e=U(l,"Active")},m(l,t){B(l,e,t)},d(l){l&&w(e)}}}function ne(i){let e,l="Buy",t,s;function n(){return i[6](i[8])}return{c(){e=R("button"),e.textContent=l,this.h()},l(r){e=E(r,"BUTTON",{class:!0,"data-svelte-h":!0}),L(e)!=="svelte-yl076z"&&(e.textContent=l),this.h()},h(){D(e,"class","svelte-bvbif0")},m(r,g){B(r,e,g),t||(s=z(e,"click",n),t=!0)},p(r,g){i=r},d(r){r&&w(e),t=!1,s()}}}function re(i){let e,l,t,s,n,r=i[8].name+"",g,S,G,q,c,u=i[8].description+"",v,y,d,_,I=i[8].price+"",b,C,h,k,m=i[8].id===i[1].id&&ie(),a=i[8].id!==i[1].id&&ne(i);return{c(){e=R("div"),l=R("img"),s=T(),n=R("h4"),g=V(r),S=T(),G=R("p"),m&&m.c(),q=T(),c=R("p"),v=V(u),y=T(),d=R("p"),_=V("Price: "),b=V(I),C=V(" drachmas"),h=T(),a&&a.c(),k=T(),this.h()},l(o){e=E(o,"DIV",{class:!0});var p=N(e);l=E(p,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),s=A(p),n=E(p,"H4",{});var x=N(n);g=U(x,r),x.forEach(w),S=A(p),G=E(p,"P",{class:!0});var P=N(G);m&&m.l(P),P.forEach(w),q=A(p),c=E(p,"P",{});var H=N(c);v=U(H,u),H.forEach(w),y=A(p),d=E(p,"P",{});var O=N(d);_=U(O,"Price: "),b=U(O,I),C=U(O," drachmas"),O.forEach(w),h=A(p),a&&a.l(p),k=A(p),p.forEach(w),this.h()},h(){ve(l.src,t=ge+"/game/"+i[8].img)||D(l,"src",t),D(l,"width","46px"),D(l,"height","46px"),D(l,"alt",i[8].name),D(l,"class","svelte-bvbif0"),D(G,"class","active"),D(e,"class","menu-item svelte-bvbif0")},m(o,p){B(o,e,p),f(e,l),f(e,s),f(e,n),f(n,g),f(e,S),f(e,G),m&&m.m(G,null),f(e,q),f(e,c),f(c,v),f(e,y),f(e,d),f(d,_),f(d,b),f(d,C),f(e,h),a&&a.m(e,null),f(e,k)},p(o,p){o[8].id===o[1].id?m||(m=ie(),m.c(),m.m(G,null)):m&&(m.d(1),m=null),o[8].id!==o[1].id?a?a.p(o,p):(a=ne(o),a.c(),a.m(e,k)):a&&(a.d(1),a=null)},d(o){o&&w(e),m&&m.d(),a&&a.d()}}}function Ee(i){let e,l,t="Relic Store",s,n,r,g=`${i[1].name}
    (${M.find(i[5]).name})`,S,G,q,c,u,v,y,d=j(i[2]),_=[];for(let I=0;I<d.length;I+=1)_[I]=re(se(i,d,I));return{c(){e=R("div"),l=R("h2"),l.textContent=t,s=T(),n=R("h4"),r=V("Chosen Relic: "),S=V(g),G=T(),q=R("h4"),c=V("Drachmas: "),u=V(i[0]),v=T(),y=R("div");for(let I=0;I<_.length;I+=1)_[I].c();this.h()},l(I){e=E(I,"DIV",{class:!0});var b=N(e);l=E(b,"H2",{"data-svelte-h":!0}),L(l)!=="svelte-6gh0hs"&&(l.textContent=t),s=A(b),n=E(b,"H4",{});var C=N(n);r=U(C,"Chosen Relic: "),S=U(C,g),C.forEach(w),G=A(b),q=E(b,"H4",{});var h=N(q);c=U(h,"Drachmas: "),u=U(h,i[0]),h.forEach(w),v=A(b),y=E(b,"DIV",{});var k=N(y);for(let m=0;m<_.length;m+=1)_[m].l(k);k.forEach(w),b.forEach(w),this.h()},h(){D(e,"class","menu svelte-bvbif0")},m(I,b){B(I,e,b),f(e,l),f(e,s),f(e,n),f(n,r),f(n,S),f(e,G),f(e,q),f(q,c),f(q,u),f(e,v),f(e,y);for(let C=0;C<_.length;C+=1)_[C]&&_[C].m(y,null)},p(I,[b]){if(b&2&&g!==(g=`${I[1].name}
    (${M.find(I[5]).name})`)&&Q(S,g),b&1&&Q(u,I[0]),b&14){d=j(I[2]);let C;for(C=0;C<d.length;C+=1){const h=se(I,d,C);_[C]?_[C].p(h,b):(_[C]=re(h),_[C].c(),_[C].m(y,null))}for(;C<_.length;C+=1)_[C].d(1);_.length=d.length}},i:Z,o:Z,d(I){I&&w(e),Y(_,I)}}}function qe(i,e,l){let{drachmas:t}=e,{chosenRelic:s}=e,{curGridId:n}=e;const r=M.find(c=>c.id===F.find(u=>u.id===n).stageId),g=X.filter(c=>c.stageId===r.id),S=c=>{try{if(t>=c.price){l(0,t-=c.price),localStorage.setItem("drachmas",t),l(1,s=c),localStorage.setItem("chosenRelicId",c.id),window.location.reload();return}alert("Not enough drachmas to spend!")}catch(u){console.error(u)}},G=c=>c.id===s.stageId,q=c=>S(c);return i.$$set=c=>{"drachmas"in c&&l(0,t=c.drachmas),"chosenRelic"in c&&l(1,s=c.chosenRelic),"curGridId"in c&&l(4,n=c.curGridId)},[t,s,g,S,n,G,q]}class De extends me{constructor(e){super(),pe(this,e,qe,Ee,_e,{drachmas:0,chosenRelic:1,curGridId:4})}}function ae(i,e,l){const t=i.slice();return t[17]=e[l],t[19]=l,t}function oe(i,e,l){const t=i.slice();return t[17]=e[l],t[21]=l,t}function ce(i){let e,l,t,s,n,r,g,S,G="←",q,c,u,v="↑",y,d,_="↓",I,b,C="→",h,k,m=j(Array(K)),a=[];for(let o=0;o<m.length;o+=1)a[o]=fe(ae(i,m,o));return{c(){e=R("h2"),l=V(i[2]),t=T(),s=R("div");for(let o=0;o<a.length;o+=1)a[o].c();r=T(),g=R("div"),S=R("button"),S.textContent=G,q=T(),c=R("div"),u=R("button"),u.textContent=v,y=T(),d=R("button"),d.textContent=_,I=T(),b=R("button"),b.textContent=C,this.h()},l(o){e=E(o,"H2",{});var p=N(e);l=U(p,i[2]),p.forEach(w),t=A(o),s=E(o,"DIV",{class:!0});var x=N(s);for(let O=0;O<a.length;O+=1)a[O].l(x);x.forEach(w),r=A(o),g=E(o,"DIV",{class:!0});var P=N(g);S=E(P,"BUTTON",{class:!0,"data-svelte-h":!0}),L(S)!=="svelte-1h6m8u8"&&(S.textContent=G),q=A(P),c=E(P,"DIV",{});var H=N(c);u=E(H,"BUTTON",{class:!0,"data-svelte-h":!0}),L(u)!=="svelte-1un4tkd"&&(u.textContent=v),y=A(H),d=E(H,"BUTTON",{class:!0,"data-svelte-h":!0}),L(d)!=="svelte-16pn8vi"&&(d.textContent=_),H.forEach(w),I=A(P),b=E(P,"BUTTON",{class:!0,"data-svelte-h":!0}),L(b)!=="svelte-87vidd"&&(b.textContent=C),P.forEach(w),this.h()},h(){D(s,"class",n="grid grid-bg-"+i[1]+" svelte-sxq188"),D(S,"class","svelte-sxq188"),D(u,"class","svelte-sxq188"),D(d,"class","svelte-sxq188"),D(b,"class","svelte-sxq188"),D(g,"class","button-row")},m(o,p){B(o,e,p),f(e,l),B(o,t,p),B(o,s,p);for(let x=0;x<a.length;x+=1)a[x]&&a[x].m(s,null);B(o,r,p),B(o,g,p),f(g,S),f(g,q),f(g,c),f(c,u),f(c,y),f(c,d),f(g,I),f(g,b),h||(k=[z(S,"click",i[8]),z(u,"click",i[9]),z(d,"click",i[10]),z(b,"click",i[11])],h=!0)},p(o,p){if(p&4&&Q(l,o[2]),p&99){m=j(Array(K));let x;for(x=0;x<m.length;x+=1){const P=ae(o,m,x);a[x]?a[x].p(P,p):(a[x]=fe(P),a[x].c(),a[x].m(s,null))}for(;x<a.length;x+=1)a[x].d(1);a.length=m.length}p&2&&n!==(n="grid grid-bg-"+o[1]+" svelte-sxq188")&&D(s,"class",n)},d(o){o&&(w(e),w(t),w(s),w(r),w(g)),Y(a,o),h=!1,ke(k)}}}function de(i){let e,l;return{c(){e=R("div"),this.h()},l(t){e=E(t,"DIV",{class:!0,style:!0}),N(e).forEach(w),this.h()},h(){D(e,"class",l="cell "+i[6](i[21],i[19],i[0],i[1])+" svelte-sxq188"),ee(e,"background",i[6](i[21],i[19],i[0],i[1])==="player"?i[5].style:"")},m(t,s){B(t,e,s)},p(t,s){s&3&&l!==(l="cell "+t[6](t[21],t[19],t[0],t[1])+" svelte-sxq188")&&D(e,"class",l),s&35&&ee(e,"background",t[6](t[21],t[19],t[0],t[1])==="player"?t[5].style:"")},d(t){t&&w(e)}}}function fe(i){let e,l=j(Array(K)),t=[];for(let s=0;s<l.length;s+=1)t[s]=de(oe(i,l,s));return{c(){for(let s=0;s<t.length;s+=1)t[s].c();e=$()},l(s){for(let n=0;n<t.length;n+=1)t[n].l(s);e=$()},m(s,n){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(s,n);B(s,e,n)},p(s,n){if(n&99){l=j(Array(K));let r;for(r=0;r<l.length;r+=1){const g=oe(s,l,r);t[r]?t[r].p(g,n):(t[r]=de(g),t[r].c(),t[r].m(e.parentNode,e))}for(;r<t.length;r+=1)t[r].d(1);t.length=l.length}},d(s){s&&w(e),Y(t,s)}}}function he(i){let e,l="Battle",t,s;return{c(){e=R("button"),e.textContent=l,this.h()},l(n){e=E(n,"BUTTON",{class:!0,"data-svelte-h":!0}),L(e)!=="svelte-1th9psb"&&(e.textContent=l),this.h()},h(){D(e,"class","svelte-sxq188")},m(n,r){B(n,e,r),t||(s=z(e,"click",i[13]),t=!0)},d(n){n&&w(e),t=!1,s()}}}function ue(i){let e,l;return e=new De({props:{drachmas:i[4],chosenRelic:i[5],curGridId:i[1]}}),{c(){xe(e.$$.fragment)},l(t){we(e.$$.fragment,t)},m(t,s){Ce(e,t,s),l=!0},p(t,s){const n={};s&16&&(n.drachmas=t[4]),s&32&&(n.chosenRelic=t[5]),s&2&&(n.curGridId=t[1]),e.$set(n)},i(t){l||(J(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){Se(e,t)}}}function Te(i){let e,l,t,s,n=i[3]?"Close Relic Store":"Relic Store",r,g,S,G,q,c,u=!i[3]&&ce(i),v=!i[3]&&he(i),y=i[3]&&ue(i);return{c(){e=R("div"),u&&u.c(),l=T(),t=R("div"),s=R("button"),r=V(n),g=T(),v&&v.c(),S=T(),y&&y.c(),this.h()},l(d){e=E(d,"DIV",{class:!0});var _=N(e);u&&u.l(_),l=A(_),t=E(_,"DIV",{class:!0});var I=N(t);s=E(I,"BUTTON",{class:!0});var b=N(s);r=U(b,n),b.forEach(w),g=A(I),v&&v.l(I),I.forEach(w),S=A(_),y&&y.l(_),_.forEach(w),this.h()},h(){D(s,"class","svelte-sxq188"),D(t,"class","button-row"),D(e,"class","game-container svelte-sxq188")},m(d,_){B(d,e,_),u&&u.m(e,null),f(e,l),f(e,t),f(t,s),f(s,r),f(t,g),v&&v.m(t,null),f(e,S),y&&y.m(e,null),G=!0,q||(c=z(s,"click",i[12]),q=!0)},p(d,[_]){d[3]?u&&(u.d(1),u=null):u?u.p(d,_):(u=ce(d),u.c(),u.m(e,l)),(!G||_&8)&&n!==(n=d[3]?"Close Relic Store":"Relic Store")&&Q(r,n),d[3]?v&&(v.d(1),v=null):v||(v=he(d),v.c(),v.m(t,null)),d[3]?y?(y.p(d,_),_&8&&J(y,1)):(y=ue(d),y.c(),J(y,1),y.m(e,null)):y&&(Ge(),W(y,1,1,()=>{y=null}),be())},i(d){G||(J(y),G=!0)},o(d){W(y),G=!1},d(d){d&&w(e),u&&u.d(),v&&v.d(),y&&y.d(),q=!1,c()}}}const K=5;function Ae(i,e,l){let t={x:2,y:2},s=1,n=M[0].name,r=!1,g=0,S=0,G=X[0];const q=h=>{h.key==="ArrowUp"&&(h.preventDefault(),v("up")),h.key==="ArrowDown"&&(h.preventDefault(),v("down")),h.key==="ArrowLeft"&&(h.preventDefault(),v("left")),h.key==="ArrowRight"&&(h.preventDefault(),v("right"))},c=(h,k,m,a)=>{try{if(m.x===h&&m.y===k)return"player";const o=F.find(x=>x.id===a),p=o.rocks.find(x=>x.x===h&&x.y===k);return(p==null?void 0:p.type)==="plain"?"rock-plain":(p==null?void 0:p.type)==="smooth"?"rock-smooth":o.exits.find(x=>x.x===h&&x.y===k)?"exit":""}catch(o){console.error(o)}},u=()=>{const h=F.find(m=>m.id===s).exits.find(m=>m.x===t.x&&m.y===t.y),k=M.find(m=>m.id===F.find(a=>a.id===h.destGridId).stageId);if(g<k.expReq){alert("Not enough experience to use portal! (Requires "+k.expReq+" experience)");return}h&&(l(1,s=h.destGridId),localStorage.setItem("curStageId",k.id),localStorage.setItem("gridId",s),l(2,n=k.name),l(0,t=h.spawn))},v=h=>{try{let k={...t};if(h==="up"&&(k.y-=1),h==="down"&&(k.y+=1),h==="left"&&(k.x-=1),h==="right"&&(k.x+=1),k.x<0||k.x>=K||k.y<0||k.y>=K)return;const m=F.find(a=>a.id===s);m.rocks.find(a=>a.x===k.x&&a.y===k.y)||l(0,t=k),m.exits.find(a=>a.x===t.x&&a.y===t.y)&&u()}catch(k){console.error(k)}};return ye(()=>{te.set(!0),le.set(!0),localStorage.getItem("curStageId")&&l(2,n=M.find(h=>h.id===parseInt(localStorage.getItem("curStageId"))).name),localStorage.getItem("gridId")&&l(1,s=parseInt(localStorage.getItem("gridId"))),localStorage.getItem("playerExperience")&&(g=parseInt(localStorage.getItem("playerExperience"))),localStorage.getItem("drachmas")&&l(4,S=parseInt(localStorage.getItem("drachmas"))),localStorage.getItem("chosenRelicId")&&l(5,G=X.find(h=>h.id===parseInt(localStorage.getItem("chosenRelicId")))),typeof window<"u"&&window.addEventListener("keydown",q)}),Ie(()=>{te.set(!1),le.set(!1),typeof window<"u"&&window.removeEventListener("keydown",q)}),[t,s,n,r,S,G,c,v,()=>v("left"),()=>v("up"),()=>v("down"),()=>v("right"),()=>l(3,r=!r),()=>Re(ge+"/game")]}class He extends me{constructor(e){super(),pe(this,e,Ae,Te,_e,{})}}export{He as component};
