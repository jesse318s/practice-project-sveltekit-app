import{s as _e,n as Z,d as ve,o as ye,f as ke,r as Ie}from"../chunks/scheduler.BoReh3vH.js";import{S as me,i as ge,e as R,s as T,t as V,c as E,a as q,y as L,f as A,b as U,d as w,o as N,g as B,h as f,j as Q,B as Y,A as z,n as J,l as W,m as be,k as $,u as we,v as Ce,w as Se,x as Ge,q as Re,p as ee}from"../chunks/index.BklZDJd0.js";import{e as K}from"../chunks/each.D6YF6ztN.js";import{s as j,r as X}from"../chunks/relics.anhpFv9_.js";import{i as te,a as le}from"../chunks/store.Cn0GNUQE.js";import{b as pe,g as Ee}from"../chunks/entry.CYhm-hFj.js";const M=[{id:1,stageId:1,rocks:[{x:1,y:1},{x:0,y:3}],exits:[{x:0,y:0,destGridId:2,spawn:{x:4,y:4}},{x:4,y:2,destGridId:2,spawn:{x:0,y:2}},{x:2,y:4,destGridId:2,spawn:{x:2,y:0}}]},{id:2,stageId:1,rocks:[{x:3,y:1}],exits:[{x:1,y:0,destGridId:1,spawn:{x:3,y:4}},{x:4,y:3,destGridId:3,spawn:{x:0,y:1}}]},{id:3,stageId:2,rocks:[{x:1,y:3},{x:4,y:1}],exits:[{x:0,y:4,destGridId:2,spawn:{x:4,y:0}},{x:4,y:0,destGridId:4,spawn:{x:0,y:4}},{x:2,y:0,destGridId:4,spawn:{x:2,y:4}}]},{id:4,stageId:2,rocks:[{x:0,y:2},{x:2,y:3}],exits:[{x:1,y:4,destGridId:3,spawn:{x:3,y:0}},{x:3,y:0,destGridId:3,spawn:{x:1,y:4}}]}];function ie(i,e,l){const t=i.slice();return t[8]=e[l],t}function ne(i){let e;return{c(){e=V("Active")},l(l){e=U(l,"Active")},m(l,t){B(l,e,t)},d(l){l&&w(e)}}}function se(i){let e,l="Buy",t,n;function s(){return i[6](i[8])}return{c(){e=R("button"),e.textContent=l},l(r){e=E(r,"BUTTON",{"data-svelte-h":!0}),L(e)!=="svelte-yl076z"&&(e.textContent=l)},m(r,v){B(r,e,v),t||(n=z(e,"click",s),t=!0)},p(r,v){i=r},d(r){r&&w(e),t=!1,n()}}}function re(i){let e,l,t,n,s,r=i[8].name+"",v,S,G,x,c,g=i[8].description+"",y,k,h,u,I=i[8].price+"",b,C,d,p,_=i[8].id===i[1].id&&ne(),a=i[8].id!==i[1].id&&se(i);return{c(){e=R("div"),l=R("img"),n=T(),s=R("h4"),v=V(r),S=T(),G=R("p"),_&&_.c(),x=T(),c=R("p"),y=V(g),k=T(),h=R("p"),u=V("Price: "),b=V(I),C=V(" drachmas"),d=T(),a&&a.c(),p=T(),this.h()},l(o){e=E(o,"DIV",{class:!0});var m=q(e);l=E(m,"IMG",{src:!0,width:!0,height:!0,alt:!0,class:!0}),n=A(m),s=E(m,"H4",{});var D=q(s);v=U(D,r),D.forEach(w),S=A(m),G=E(m,"P",{class:!0});var P=q(G);_&&_.l(P),P.forEach(w),x=A(m),c=E(m,"P",{});var H=q(c);y=U(H,g),H.forEach(w),k=A(m),h=E(m,"P",{});var O=q(h);u=U(O,"Price: "),b=U(O,I),C=U(O," drachmas"),O.forEach(w),d=A(m),a&&a.l(m),p=A(m),m.forEach(w),this.h()},h(){ve(l.src,t=pe+"/game/"+i[8].img)||N(l,"src",t),N(l,"width","46px"),N(l,"height","46px"),N(l,"alt",i[8].name),N(l,"class","svelte-10kmyxf"),N(G,"class","active"),N(e,"class","menu-item svelte-10kmyxf")},m(o,m){B(o,e,m),f(e,l),f(e,n),f(e,s),f(s,v),f(e,S),f(e,G),_&&_.m(G,null),f(e,x),f(e,c),f(c,y),f(e,k),f(e,h),f(h,u),f(h,b),f(h,C),f(e,d),a&&a.m(e,null),f(e,p)},p(o,m){o[8].id===o[1].id?_||(_=ne(),_.c(),_.m(G,null)):_&&(_.d(1),_=null),o[8].id!==o[1].id?a?a.p(o,m):(a=se(o),a.c(),a.m(e,p)):a&&(a.d(1),a=null)},d(o){o&&w(e),_&&_.d(),a&&a.d()}}}function xe(i){let e,l,t="Relic Store",n,s,r,v=`${i[1].name}
    (${j.find(i[5]).name})`,S,G,x,c,g,y,k,h=K(i[2]),u=[];for(let I=0;I<h.length;I+=1)u[I]=re(ie(i,h,I));return{c(){e=R("div"),l=R("h2"),l.textContent=t,n=T(),s=R("h4"),r=V("Chosen Relic: "),S=V(v),G=T(),x=R("h4"),c=V("Drachmas: "),g=V(i[0]),y=T(),k=R("div");for(let I=0;I<u.length;I+=1)u[I].c();this.h()},l(I){e=E(I,"DIV",{class:!0});var b=q(e);l=E(b,"H2",{"data-svelte-h":!0}),L(l)!=="svelte-6gh0hs"&&(l.textContent=t),n=A(b),s=E(b,"H4",{});var C=q(s);r=U(C,"Chosen Relic: "),S=U(C,v),C.forEach(w),G=A(b),x=E(b,"H4",{});var d=q(x);c=U(d,"Drachmas: "),g=U(d,i[0]),d.forEach(w),y=A(b),k=E(b,"DIV",{});var p=q(k);for(let _=0;_<u.length;_+=1)u[_].l(p);p.forEach(w),b.forEach(w),this.h()},h(){N(e,"class","menu svelte-10kmyxf")},m(I,b){B(I,e,b),f(e,l),f(e,n),f(e,s),f(s,r),f(s,S),f(e,G),f(e,x),f(x,c),f(x,g),f(e,y),f(e,k);for(let C=0;C<u.length;C+=1)u[C]&&u[C].m(k,null)},p(I,[b]){if(b&2&&v!==(v=`${I[1].name}
    (${j.find(I[5]).name})`)&&Q(S,v),b&1&&Q(g,I[0]),b&14){h=K(I[2]);let C;for(C=0;C<h.length;C+=1){const d=ie(I,h,C);u[C]?u[C].p(d,b):(u[C]=re(d),u[C].c(),u[C].m(k,null))}for(;C<u.length;C+=1)u[C].d(1);u.length=h.length}},i:Z,o:Z,d(I){I&&w(e),Y(u,I)}}}function De(i,e,l){let{drachmas:t}=e,{chosenRelic:n}=e,{curGridId:s}=e;const r=j.find(c=>c.id===M.find(g=>g.id===s).stageId),v=X.filter(c=>c.stageId===r.id),S=c=>{try{if(t>=c.price){l(0,t-=c.price),localStorage.setItem("drachmas",t),l(1,n=c),localStorage.setItem("chosenRelicId",c.id),window.location.reload();return}alert("Not enough drachmas to spend!")}catch(g){console.error(g)}},G=c=>c.id===n.stageId,x=c=>S(c);return i.$$set=c=>{"drachmas"in c&&l(0,t=c.drachmas),"chosenRelic"in c&&l(1,n=c.chosenRelic),"curGridId"in c&&l(4,s=c.curGridId)},[t,n,v,S,s,G,x]}class Te extends me{constructor(e){super(),ge(this,e,De,xe,_e,{drachmas:0,chosenRelic:1,curGridId:4})}}function ae(i,e,l){const t=i.slice();return t[17]=e[l],t[19]=l,t}function oe(i,e,l){const t=i.slice();return t[17]=e[l],t[21]=l,t}function ce(i){let e,l,t,n,s,r,v,S,G="←",x,c,g,y="↑",k,h,u="↓",I,b,C="→",d,p,_=K(Array(F)),a=[];for(let o=0;o<_.length;o+=1)a[o]=fe(ae(i,_,o));return{c(){e=R("h2"),l=V(i[2]),t=T(),n=R("div");for(let o=0;o<a.length;o+=1)a[o].c();r=T(),v=R("div"),S=R("button"),S.textContent=G,x=T(),c=R("div"),g=R("button"),g.textContent=y,k=T(),h=R("button"),h.textContent=u,I=T(),b=R("button"),b.textContent=C,this.h()},l(o){e=E(o,"H2",{});var m=q(e);l=U(m,i[2]),m.forEach(w),t=A(o),n=E(o,"DIV",{class:!0});var D=q(n);for(let O=0;O<a.length;O+=1)a[O].l(D);D.forEach(w),r=A(o),v=E(o,"DIV",{class:!0});var P=q(v);S=E(P,"BUTTON",{"data-svelte-h":!0}),L(S)!=="svelte-1h6m8u8"&&(S.textContent=G),x=A(P),c=E(P,"DIV",{});var H=q(c);g=E(H,"BUTTON",{"data-svelte-h":!0}),L(g)!=="svelte-1un4tkd"&&(g.textContent=y),k=A(H),h=E(H,"BUTTON",{"data-svelte-h":!0}),L(h)!=="svelte-16pn8vi"&&(h.textContent=u),H.forEach(w),I=A(P),b=E(P,"BUTTON",{"data-svelte-h":!0}),L(b)!=="svelte-87vidd"&&(b.textContent=C),P.forEach(w),this.h()},h(){N(n,"class",s="grid grid-bg-"+i[1]+" svelte-hq7m9d"),N(v,"class","button-row")},m(o,m){B(o,e,m),f(e,l),B(o,t,m),B(o,n,m);for(let D=0;D<a.length;D+=1)a[D]&&a[D].m(n,null);B(o,r,m),B(o,v,m),f(v,S),f(v,x),f(v,c),f(c,g),f(c,k),f(c,h),f(v,I),f(v,b),d||(p=[z(S,"click",i[8]),z(g,"click",i[9]),z(h,"click",i[10]),z(b,"click",i[11])],d=!0)},p(o,m){if(m&4&&Q(l,o[2]),m&99){_=K(Array(F));let D;for(D=0;D<_.length;D+=1){const P=ae(o,_,D);a[D]?a[D].p(P,m):(a[D]=fe(P),a[D].c(),a[D].m(n,null))}for(;D<a.length;D+=1)a[D].d(1);a.length=_.length}m&2&&s!==(s="grid grid-bg-"+o[1]+" svelte-hq7m9d")&&N(n,"class",s)},d(o){o&&(w(e),w(t),w(n),w(r),w(v)),Y(a,o),d=!1,Ie(p)}}}function de(i){let e,l;return{c(){e=R("div"),this.h()},l(t){e=E(t,"DIV",{class:!0,style:!0}),q(e).forEach(w),this.h()},h(){N(e,"class",l="cell "+i[6](i[21],i[19],i[0],i[1])+" svelte-hq7m9d"),ee(e,"background",i[6](i[21],i[19],i[0],i[1])==="player"?i[5].style:"")},m(t,n){B(t,e,n)},p(t,n){n&3&&l!==(l="cell "+t[6](t[21],t[19],t[0],t[1])+" svelte-hq7m9d")&&N(e,"class",l),n&35&&ee(e,"background",t[6](t[21],t[19],t[0],t[1])==="player"?t[5].style:"")},d(t){t&&w(e)}}}function fe(i){let e,l=K(Array(F)),t=[];for(let n=0;n<l.length;n+=1)t[n]=de(oe(i,l,n));return{c(){for(let n=0;n<t.length;n+=1)t[n].c();e=$()},l(n){for(let s=0;s<t.length;s+=1)t[s].l(n);e=$()},m(n,s){for(let r=0;r<t.length;r+=1)t[r]&&t[r].m(n,s);B(n,e,s)},p(n,s){if(s&99){l=K(Array(F));let r;for(r=0;r<l.length;r+=1){const v=oe(n,l,r);t[r]?t[r].p(v,s):(t[r]=de(v),t[r].c(),t[r].m(e.parentNode,e))}for(;r<t.length;r+=1)t[r].d(1);t.length=l.length}},d(n){n&&w(e),Y(t,n)}}}function he(i){let e,l="Battle",t,n;return{c(){e=R("button"),e.textContent=l},l(s){e=E(s,"BUTTON",{"data-svelte-h":!0}),L(e)!=="svelte-1th9psb"&&(e.textContent=l)},m(s,r){B(s,e,r),t||(n=z(e,"click",i[13]),t=!0)},d(s){s&&w(e),t=!1,n()}}}function ue(i){let e,l;return e=new Te({props:{drachmas:i[4],chosenRelic:i[5],curGridId:i[1]}}),{c(){we(e.$$.fragment)},l(t){Ce(e.$$.fragment,t)},m(t,n){Se(e,t,n),l=!0},p(t,n){const s={};n&16&&(s.drachmas=t[4]),n&32&&(s.chosenRelic=t[5]),n&2&&(s.curGridId=t[1]),e.$set(s)},i(t){l||(J(e.$$.fragment,t),l=!0)},o(t){W(e.$$.fragment,t),l=!1},d(t){Ge(e,t)}}}function Ae(i){let e,l,t,n,s=i[3]?"Close Relic Store":"Relic Store",r,v,S,G,x,c,g=!i[3]&&ce(i),y=!i[3]&&he(i),k=i[3]&&ue(i);return{c(){e=R("div"),g&&g.c(),l=T(),t=R("div"),n=R("button"),r=V(s),v=T(),y&&y.c(),S=T(),k&&k.c(),this.h()},l(h){e=E(h,"DIV",{class:!0});var u=q(e);g&&g.l(u),l=A(u),t=E(u,"DIV",{class:!0});var I=q(t);n=E(I,"BUTTON",{});var b=q(n);r=U(b,s),b.forEach(w),v=A(I),y&&y.l(I),I.forEach(w),S=A(u),k&&k.l(u),u.forEach(w),this.h()},h(){N(t,"class","button-row"),N(e,"class","game-container svelte-hq7m9d")},m(h,u){B(h,e,u),g&&g.m(e,null),f(e,l),f(e,t),f(t,n),f(n,r),f(t,v),y&&y.m(t,null),f(e,S),k&&k.m(e,null),G=!0,x||(c=z(n,"click",i[12]),x=!0)},p(h,[u]){h[3]?g&&(g.d(1),g=null):g?g.p(h,u):(g=ce(h),g.c(),g.m(e,l)),(!G||u&8)&&s!==(s=h[3]?"Close Relic Store":"Relic Store")&&Q(r,s),h[3]?y&&(y.d(1),y=null):y||(y=he(h),y.c(),y.m(t,null)),h[3]?k?(k.p(h,u),u&8&&J(k,1)):(k=ue(h),k.c(),J(k,1),k.m(e,null)):k&&(Re(),W(k,1,1,()=>{k=null}),be())},i(h){G||(J(k),G=!0)},o(h){W(k),G=!1},d(h){h&&w(e),g&&g.d(),y&&y.d(),k&&k.d(),x=!1,c()}}}const F=5;function qe(i,e,l){let t={x:2,y:2},n=1,s=j[0].name,r=!1,v=0,S=0,G=X[0];const x=d=>{d.key==="ArrowUp"&&(d.preventDefault(),y("up")),d.key==="ArrowDown"&&(d.preventDefault(),y("down")),d.key==="ArrowLeft"&&(d.preventDefault(),y("left")),d.key==="ArrowRight"&&(d.preventDefault(),y("right"))},c=(d,p,_,a)=>{try{if(_.x===d&&_.y===p)return"player";const o=M.find(m=>m.id===a);return o.rocks.find(m=>m.x===d&&m.y===p)?"rock":o.exits.find(m=>m.x===d&&m.y===p)?"exit":""}catch(o){console.error(o)}},g=()=>{const d=M.find(_=>_.id===n).exits.find(_=>_.x===t.x&&_.y===t.y),p=j.find(_=>_.id===M.find(a=>a.id===d.destGridId).stageId);if(v<p.expReq){alert("Not enough experience to use portal! (Requires "+p.expReq+" experience)");return}d&&(l(1,n=d.destGridId),localStorage.setItem("curStageId",p.id),l(2,s=p.name),l(0,t=d.spawn))},y=d=>{try{let p={...t};if(d==="up"&&(p.y-=1),d==="down"&&(p.y+=1),d==="left"&&(p.x-=1),d==="right"&&(p.x+=1),p.x<0||p.x>=F||p.y<0||p.y>=F)return;const _=M.find(a=>a.id===n);_.rocks.find(a=>a.x===p.x&&a.y===p.y)||l(0,t=p),_.exits.find(a=>a.x===t.x&&a.y===t.y)&&g()}catch(p){console.error(p)}};return ye(()=>{if(te.set(!0),le.set(!0),localStorage.getItem("curStageId")){const d=j.find(p=>p.id===parseInt(localStorage.getItem("curStageId")));l(1,n=parseInt(M.find(p=>p.stageId===d.id).id)),l(2,s=d.name)}localStorage.getItem("playerExperience")&&(v=parseInt(localStorage.getItem("playerExperience"))),localStorage.getItem("drachmas")&&l(4,S=parseInt(localStorage.getItem("drachmas"))),localStorage.getItem("chosenRelicId")&&l(5,G=X.find(d=>d.id===parseInt(localStorage.getItem("chosenRelicId")))),typeof window<"u"&&window.addEventListener("keydown",x)}),ke(()=>{te.set(!1),le.set(!1),typeof window<"u"&&window.removeEventListener("keydown",x)}),[t,n,s,r,S,G,c,y,()=>y("left"),()=>y("up"),()=>y("down"),()=>y("right"),()=>l(3,r=!r),()=>Ee(pe+"/game")]}class He extends me{constructor(e){super(),ge(this,e,qe,Ae,_e,{})}}export{He as component};
